<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Higher-dimensional fitting &mdash; UltraNest 3.5.4 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="_static/icon.ico"/>
    <link rel="canonical" href="https://johannesbuchner.github.io/UltraNest/example-sine-highd.html" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorial: intrinsic distribution" href="example-intrinsic-distribution.html" />
    <link rel="prev" title="Model comparison" href="example-sine-modelcomparison.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >
            <a href="index.html" class="icon icon-home"> UltraNest
            <img src="_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.5.4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="readme.html">UltraNest</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="method.html">Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="using-ultranest.html">Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="priors.html">Specifying priors</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="issues.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">Release Notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="example-sine-line.html">Time series fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="example-sine-modelcomparison.html">Model comparison</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Higher-dimensional fitting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Model">Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Generating-data">Generating data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Visualise-the-data">Visualise the data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Step-samplers-in-UltraNest">Step samplers in UltraNest</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Plot-the-parameter-posterior-probability-distribution">Plot the parameter posterior probability distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Plot-the-fit">Plot the fit</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Model-comparison">Model comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Bayesian-model-comparison">Bayesian model comparison</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example-intrinsic-distribution.html">Tutorial: intrinsic distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="example-line.html">Tutorial: fitting a line</a></li>
<li class="toctree-l1"><a class="reference internal" href="example-outliers.html">Tutorial: distribution with outliers</a></li>
<li class="toctree-l1"><a class="reference internal" href="example-sine-bayesian-workflow.html">Bayesian workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="example-warmstart.html">Warm starting</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging techniques</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">UltraNest</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Higher-dimensional fitting</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Higher-dimensional-fitting">
<h1>Higher-dimensional fitting<a class="headerlink" href="#Higher-dimensional-fitting" title="Permalink to this heading"></a></h1>
<section id="Model">
<h2>Model<a class="headerlink" href="#Model" title="Permalink to this heading"></a></h2>
<p>We again consider the sine model with gaussian measurement errors.</p>
<div class="math notranslate nohighlight">
\[y = A_1 \sin\left(2 \pi \left(\frac{t}{P_1} + t_1\right)\right) + B + \epsilon\]</div>
<p>where <span class="math notranslate nohighlight">\(\epsilon \sim \mathrm{Normal}(0, \sigma)\)</span></p>
<p>We want to test if there is another sine component present:</p>
<div class="math notranslate nohighlight">
\[y = A_1 \sin\left(2 \pi \left(\frac{t}{P_1} + t_1\right)\right) + A_2 \sin\left(2 \pi \left(\frac{t}{P_2} + t_2\right)\right) + B + \epsilon\]</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">sin</span><span class="p">,</span> <span class="n">pi</span>

<span class="k">def</span> <span class="nf">sine_model1</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">t1</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">A1</span> <span class="o">*</span> <span class="n">sin</span><span class="p">((</span><span class="n">t</span> <span class="o">/</span> <span class="n">P1</span> <span class="o">+</span> <span class="n">t1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">B</span>

<span class="k">def</span> <span class="nf">sine_model2</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">t2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">A1</span> <span class="o">*</span> <span class="n">sin</span><span class="p">((</span><span class="n">t</span> <span class="o">/</span> <span class="n">P1</span> <span class="o">+</span> <span class="n">t1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">A2</span> <span class="o">*</span> <span class="n">sin</span><span class="p">((</span><span class="n">t</span> <span class="o">/</span> <span class="n">P2</span> <span class="o">+</span> <span class="n">t2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">B</span>
</pre></div>
</div>
</div>
<p>The model has four unknown parameters per component:</p>
<ul class="simple">
<li><p>the signal offset <span class="math notranslate nohighlight">\(B\)</span></p></li>
<li><p>the amplitude <span class="math notranslate nohighlight">\(A\)</span></p></li>
<li><p>the period <span class="math notranslate nohighlight">\(P\)</span></p></li>
<li><p>the time offset <span class="math notranslate nohighlight">\(t_0\)</span></p></li>
</ul>
<p>As we will see, the second component makes the 7-dimensional parameter space already quite challenging to explore.</p>
</section>
<section id="Generating-data">
<h2>Generating data<a class="headerlink" href="#Generating-data" title="Permalink to this heading"></a></h2>
<p>Lets generate some data following this model:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><br/><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="n">n_data</span> <span class="o">=</span> <span class="mi">50</span>

<span class="c1"># time of observations</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_data</span><span class="p">)</span>
<span class="c1"># measurement values</span>
<span class="n">yerr</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">sine_model2</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">A1</span><span class="o">=</span><span class="mf">4.2</span><span class="p">,</span> <span class="n">P1</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">t1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">A2</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">P2</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">t2</span><span class="o">=</span><span class="mf">1.2</span><span class="p">),</span> <span class="n">yerr</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
</section>
<section id="Visualise-the-data">
<h2>Visualise the data<a class="headerlink" href="#Visualise-the-data" title="Permalink to this heading"></a></h2>
<p>Lets plot the data first to see what is going on:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span>
             <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">t_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example-sine-highd_6_0.png" src="_images/example-sine-highd_6_0.png" />
</div>
</div>
<p>A beautiful noisy data set, but we can see the modulation.</p>
<p>Now the question is: what model parameters are allowed under these data?</p>
<p>First, we need to define the parameter ranges through a prior:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parameters1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;A1&#39;</span><span class="p">,</span> <span class="s1">&#39;P1&#39;</span><span class="p">,</span> <span class="s1">&#39;t1&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">prior_transform1</span><span class="p">(</span><span class="n">cube</span><span class="p">):</span>
    <span class="c1"># the argument, cube, consists of values from 0 to 1</span>
    <span class="c1"># we have to convert them to physical scales</span>

    <span class="n">params</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># let background level go from -10 to +10</span>
    <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">-</span> <span class="mi">10</span>
    <span class="c1"># let amplitude go from 0.1 to 100</span>
    <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">cube</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># let period go from 0.3 to 30</span>
    <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">cube</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># let time go from 0 to 1</span>
    <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">params</span>

<span class="n">parameters2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;A1&#39;</span><span class="p">,</span> <span class="s1">&#39;P1&#39;</span><span class="p">,</span> <span class="s1">&#39;t1&#39;</span><span class="p">,</span> <span class="s1">&#39;A2&#39;</span><span class="p">,</span> <span class="s1">&#39;P2&#39;</span><span class="p">,</span> <span class="s1">&#39;t2&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">prior_transform2</span><span class="p">(</span><span class="n">cube</span><span class="p">):</span>
    <span class="c1"># the argument, cube, consists of values from 0 to 1</span>
    <span class="c1"># we have to convert them to physical scales</span>

    <span class="n">params</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># let background level go from -10 to +10</span>
    <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">-</span> <span class="mi">10</span>
    <span class="c1"># let amplitude go from 0.1 to 100</span>
    <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">cube</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># let period go from 0.3 to 30</span>
    <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">cube</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># let time go from 0 to 1</span>
    <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="c1"># let amplitude go from 0.01 to 100</span>
    <span class="n">params</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">cube</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># let period go from 0.3 to 30</span>
    <span class="n">params</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">cube</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># let time go from 0 to 1</span>
    <span class="n">params</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">params</span>
<br/></pre></div>
</div>
</div>
<p>Define the likelihood, which measures how far the data are from the model predictions. More precisely, how often the parameters would arise under the given parameters. We assume gaussian measurement errors of known size (yerr).</p>
<div class="math notranslate nohighlight">
\[\chi^2 = \sum\left(\frac{m_i-y_i}{\sigma}\right)^2\]</div>
<div class="math notranslate nohighlight">
\[\log \cal{L} = -\chi^2 / 2\]</div>
<p>where the model is the sine_model function from above at time <span class="math notranslate nohighlight">\(t_i\)</span>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.stats</span>

<span class="k">def</span> <span class="nf">log_likelihood1</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="c1"># unpack the current parameters:</span>
    <span class="n">B</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">t1</span> <span class="o">=</span> <span class="n">params</span>

    <span class="c1"># compute for each x point, where it should lie in y</span>
    <span class="n">y_model</span> <span class="o">=</span> <span class="n">sine_model1</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="n">B</span><span class="p">,</span> <span class="n">A1</span><span class="o">=</span><span class="n">A1</span><span class="p">,</span> <span class="n">P1</span><span class="o">=</span><span class="n">P1</span><span class="p">,</span> <span class="n">t1</span><span class="o">=</span><span class="n">t1</span><span class="p">)</span>
    <span class="c1"># compute likelihood</span>
    <span class="n">loglike</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(((</span><span class="n">y_model</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">yerr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">loglike</span>

<span class="k">def</span> <span class="nf">log_likelihood2</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="c1"># unpack the current parameters:</span>
    <span class="n">B</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">params</span>

    <span class="c1"># avoid unnecessary multiple solutions:</span>
    <span class="c1">#    force ordering by period from large to small</span>
    <span class="k">if</span> <span class="n">P1</span> <span class="o">&lt;</span> <span class="n">P2</span><span class="p">:</span>
        <span class="c1"># instead of returning a very low number:</span>
        <span class="c1">## return -1e300</span>
        <span class="c1"># which would give a likelihood plateau causing some loss of live points</span>
        <span class="c1"># we give a slope towards the &quot;good&quot; parameter space:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">1e300</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">P1</span> <span class="o">-</span> <span class="n">P2</span><span class="p">)</span>

    <span class="c1"># compute for each x point, where it should lie in y</span>
    <span class="n">y_model</span> <span class="o">=</span> <span class="n">sine_model2</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="n">B</span><span class="p">,</span> <span class="n">A1</span><span class="o">=</span><span class="n">A1</span><span class="p">,</span> <span class="n">P1</span><span class="o">=</span><span class="n">P1</span><span class="p">,</span> <span class="n">t1</span><span class="o">=</span><span class="n">t1</span><span class="p">,</span> <span class="n">A2</span><span class="o">=</span><span class="n">A2</span><span class="p">,</span> <span class="n">P2</span><span class="o">=</span><span class="n">P2</span><span class="p">,</span> <span class="n">t2</span><span class="o">=</span><span class="n">t2</span><span class="p">)</span>
    <span class="c1"># compute likelihood</span>
    <span class="n">loglike</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(((</span><span class="n">y_model</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">yerr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">loglike</span>
</pre></div>
</div>
</div>
<p>Solve the problem:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ultranest</span>

<span class="n">sampler1</span> <span class="o">=</span> <span class="n">ultranest</span><span class="o">.</span><span class="n">ReactiveNestedSampler</span><span class="p">(</span>
    <span class="n">parameters1</span><span class="p">,</span>
    <span class="n">log_likelihood1</span><span class="p">,</span> <span class="n">prior_transform1</span><span class="p">,</span>
    <span class="n">wrapped_params</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">sampler2</span> <span class="o">=</span> <span class="n">ultranest</span><span class="o">.</span><span class="n">ReactiveNestedSampler</span><span class="p">(</span>
    <span class="n">parameters2</span><span class="p">,</span>
    <span class="n">log_likelihood2</span><span class="p">,</span>
    <span class="n">prior_transform2</span><span class="p">,</span>
    <span class="n">wrapped_params</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>First, we solve the simpler model:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result1</span> <span class="o">=</span> <span class="n">sampler1</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">min_num_live_points</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">sampler1</span><span class="o">.</span><span class="n">print_results</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ultranest] Sampling 400 live points from prior ...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "36c8a23fc9314d4382ddc2543cf55e32", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ultranest] Explored until L=-4e+01   [-35.7755..-35.7752]*| it/evals=8440/59678 eff=14.2380% N=400    0 0
[ultranest] Likelihood function evaluations: 59697
[ultranest]   logZ = -52.21 +- 0.1439
[ultranest] Effective samples strategy satisfied (ESS = 2209.0, need &gt;400)
[ultranest] Posterior uncertainty strategy is satisfied (KL: 0.46+-0.05 nat, need &lt;0.50 nat)
[ultranest] Evidency uncertainty strategy is satisfied (dlogz=0.14, need &lt;0.5)
[ultranest]   logZ error budget: single: 0.19 bs:0.14 tail:0.01 total:0.14 required:&lt;0.50
[ultranest] done iterating.

logZ = -52.252 +- 0.301
  single instance: logZ = -52.252 +- 0.190
  bootstrapped   : logZ = -52.214 +- 0.301
  tail           : logZ = +- 0.010
insert order U test : converged: True correlation: inf iterations

    B                   : 0.36  │ ▁  ▁▁▁▁▁▁▁▁▂▂▃▄▅▆▆▇▇▇▇▆▆▅▄▄▂▁▁▁▁▁▁▁ ▁ │1.64      1.04 +- 0.15
    A1                  : 3.07  │ ▁▁▁▁▁▁▁▁▂▂▂▃▃▄▅▇▇▇▇▇▇▆▅▅▄▃▂▂▂▁▁▁▁▁▁▁▁ │4.80      3.94 +- 0.22
    P1                  : 2.878 │ ▁▁▁▁▁▁▁▁▂▃▃▄▄▅▇▇▇▇▇▆▅▅▄▄▃▃▂▂▁▁▁▁▁▁▁▁▁ │3.294     3.074 +- 0.055
    t1                  : 0.00  │▇▄▁                                  ▁▂│1.00      0.18 +- 0.36

</pre></div></div>
</div>
<p>Now lets have a go at the harder problem. We limit the number of evaluations:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result2</span> <span class="o">=</span> <span class="n">sampler2</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">min_num_live_points</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">max_ncalls</span><span class="o">=</span><span class="mi">400000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ultranest] Sampling 400 live points from prior ...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "1bddc773e7224f198f77288b819f15c0", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Z=-184.4(0.00%) | Like=-174.71..-46.75 [-184.3100..-169.5248] | it/evals=2752/159174 eff=1.7333% N=400
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/user/.local/lib/python3.10/site-packages/ultranest-3.5.4-py3.10-linux-x86_64.egg/ultranest/integrator.py:1732: UserWarning: Sampling from region seems inefficient (0/40 accepted in iteration 2500). To improve efficiency, modify the transformation so that the current live points are ellipsoidal, or use a stepsampler, or set frac_remain to a lower number (e.g., 0.5) to terminate earlier.
  warnings.warn(warning_message)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ultranest] Explored until L=-4e+01  2 [-124.0658..-104.8495] | it/evals=3564/400459 eff=0.8909% N=400
[ultranest] Likelihood function evaluations: 400459
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/lib/python3/dist-packages/numpy/core/_methods.py:233: RuntimeWarning: overflow encountered in multiply
  x = um.multiply(x, x, out=x)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ultranest] Reached maximum number of likelihood calls (400459 &gt; 400000)...
[ultranest] done iterating.
</pre></div></div>
</div>
<p>The efficiency is very low. This is not just because of the dimensionality of the problem, but also because of the degeneracies.</p>
<p>To make progress in high-dimensional or otherwise tricky problems, a step sampler can be used.</p>
</section>
<section id="Step-samplers-in-UltraNest">
<h2>Step samplers in UltraNest<a class="headerlink" href="#Step-samplers-in-UltraNest" title="Permalink to this heading"></a></h2>
<p>To find a replacement live point, step samplers perform a random walk in parameter space. After a number of steps (nsteps), the final point is declared a “independent” sample.</p>
<p>There are several step samplers available. Here we will use a <a class="reference external" href="https://johannesbuchner.github.io/UltraNest/ultranest.html#ultranest.stepsampler.SliceSampler">SliceSampler</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ultranest.stepsampler</span>

<span class="c1"># have to choose the number of steps the slice sampler should take</span>
<span class="c1"># after first results, this should be increased and checked for consistency.</span>

<span class="n">nsteps</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters2</span><span class="p">)</span>
<span class="c1"># create step sampler:</span>
<span class="n">sampler2</span><span class="o">.</span><span class="n">stepsampler</span> <span class="o">=</span> <span class="n">ultranest</span><span class="o">.</span><span class="n">stepsampler</span><span class="o">.</span><span class="n">SliceSampler</span><span class="p">(</span>
    <span class="n">nsteps</span><span class="o">=</span><span class="n">nsteps</span><span class="p">,</span>
    <span class="n">generate_direction</span><span class="o">=</span><span class="n">ultranest</span><span class="o">.</span><span class="n">stepsampler</span><span class="o">.</span><span class="n">generate_mixture_random_direction</span><span class="p">,</span>
    <span class="c1"># adaptive_nsteps=False,</span>
    <span class="c1"># max_nsteps=400</span>
<span class="p">)</span>

<span class="c1"># run again:</span>
<span class="n">result2</span> <span class="o">=</span> <span class="n">sampler2</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">min_num_live_points</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">sampler2</span><span class="o">.</span><span class="n">print_results</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ultranest] Widening roots to 400 live points (have 400 already) ...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "9f2ec77fc6ac474c92c5fad0ad5251f5", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ultranest] Explored until L=-2e+01   [-19.8059..-19.8052]*| it/evals=12427/929849 eff=1.6740% N=400
[ultranest] Likelihood function evaluations: 930279
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/lib/python3/dist-packages/numpy/core/_methods.py:233: RuntimeWarning: overflow encountered in multiply
  x = um.multiply(x, x, out=x)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ultranest]   logZ = -46.08 +- 0.2089
[ultranest] Effective samples strategy satisfied (ESS = 2942.8, need &gt;400)
[ultranest] Posterior uncertainty strategy is satisfied (KL: 0.45+-0.07 nat, need &lt;0.50 nat)
[ultranest] Evidency uncertainty strategy wants 398 minimum live points (dlogz from 0.18 to 0.58, need &lt;0.5)
[ultranest]   logZ error budget: single: 0.24 bs:0.21 tail:0.01 total:0.21 required:&lt;0.50
[ultranest] done iterating.

logZ = -46.147 +- 0.580
  single instance: logZ = -46.147 +- 0.241
  bootstrapped   : logZ = -46.079 +- 0.580
  tail           : logZ = +- 0.010
insert order U test : converged: True correlation: inf iterations

    B                   : 0.41  │ ▁▁▁▁▁▁▁▁▁▂▃▃▄▄▆▆▆▇▇▇▇▇▅▄▄▃▂▂▁▁▁▁▁▁▁▁▁ │1.62      1.01 +- 0.15
    A1                  : 0.10  │▁▁▁                     ▁▁▁▂▄▆▇▇▄▂▁▁▁▁ │5.31      4.19 +- 0.24
    P1                  : 1.00  │▁▇▁ ▁             ▁      ▁           ▁ │77.45     3.07 +- 0.82
    t1                  : 0.00  │▇▃▁▁ ▁ ▁  ▁▁        ▁   ▁         ▁▁▁▁▃│1.00      0.22 +- 0.40
    A2                  : 0.10  │▁▁▁▁▁▁▃▄▇▇▇▆▄▂▁▁▁▁ ▁           ▁▁ ▁▁ ▁ │4.50      1.21 +- 0.25
    P2                  : 1.000 │ ▁▁▃▇▂▁▁              ▁           ▁▁▁▁ │3.264     1.254 +- 0.059
    t2                  : 0.000 │▁▁▁▁▁▁▁▁▁▂▃▄▅▆▇▇▅▄▂▂▁▁▁▁▁▁  ▁        ▁ │0.718     0.262 +- 0.053

</pre></div></div>
</div>
<p>The efficiency is now constant, and proportional to 1/nsteps.</p>
</section>
<section id="Plot-the-parameter-posterior-probability-distribution">
<h2>Plot the parameter posterior probability distribution<a class="headerlink" href="#Plot-the-parameter-posterior-probability-distribution" title="Permalink to this heading"></a></h2>
<p>A classic corner plot:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ultranest.plot</span> <span class="kn">import</span> <span class="n">cornerplot</span>
<span class="n">cornerplot</span><span class="p">(</span><span class="n">result1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example-sine-highd_21_0.png" src="_images/example-sine-highd_21_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cornerplot</span><span class="p">(</span><span class="n">result2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example-sine-highd_22_0.png" src="_images/example-sine-highd_22_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sampler1</span><span class="o">.</span><span class="n">ncall</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
59697
</pre></div></div>
</div>
</section>
<section id="Plot-the-fit">
<h2>Plot the fit<a class="headerlink" href="#Plot-the-fit" title="Permalink to this heading"></a></h2>
<p>To evaluate whether the results make any sense, we want to look whether the fitted function goes through the data points.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;1-sine fit&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span>
             <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>


<span class="n">t_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">ultranest.plot</span> <span class="kn">import</span> <span class="n">PredictionBand</span>
<span class="n">band</span> <span class="o">=</span> <span class="n">PredictionBand</span><span class="p">(</span><span class="n">t_grid</span><span class="p">)</span>

<span class="c1"># go through the solutions</span>
<span class="k">for</span> <span class="n">B</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">t1</span> <span class="ow">in</span> <span class="n">sampler1</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]:</span>
    <span class="c1"># compute for each time the y value</span>
    <span class="n">band</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sine_model1</span><span class="p">(</span><span class="n">t_grid</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="n">B</span><span class="p">,</span> <span class="n">A1</span><span class="o">=</span><span class="n">A1</span><span class="p">,</span> <span class="n">P1</span><span class="o">=</span><span class="n">P1</span><span class="p">,</span> <span class="n">t1</span><span class="o">=</span><span class="n">t1</span><span class="p">))</span>

<span class="n">band</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1"># add 1 sigma quantile</span>
<span class="n">band</span><span class="o">.</span><span class="n">shade</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="c1"># add wider quantile (0.01 .. 0.99)</span>
<span class="n">band</span><span class="o">.</span><span class="n">shade</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.49</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span>
<br/><br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example-sine-highd_26_0.png" src="_images/example-sine-highd_26_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;2-sine fit&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span>
             <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>

<span class="n">band</span> <span class="o">=</span> <span class="n">PredictionBand</span><span class="p">(</span><span class="n">t_grid</span><span class="p">)</span>

<span class="c1"># go through the solutions</span>
<span class="k">for</span> <span class="n">B</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">t2</span> <span class="ow">in</span> <span class="n">sampler2</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]:</span>
    <span class="c1"># compute for each time the y value</span>
    <span class="n">band</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sine_model2</span><span class="p">(</span><span class="n">t_grid</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="n">B</span><span class="p">,</span> <span class="n">A1</span><span class="o">=</span><span class="n">A1</span><span class="p">,</span> <span class="n">P1</span><span class="o">=</span><span class="n">P1</span><span class="p">,</span> <span class="n">t1</span><span class="o">=</span><span class="n">t1</span><span class="p">,</span> <span class="n">A2</span><span class="o">=</span><span class="n">A2</span><span class="p">,</span> <span class="n">P2</span><span class="o">=</span><span class="n">P2</span><span class="p">,</span> <span class="n">t2</span><span class="o">=</span><span class="n">t2</span><span class="p">))</span>

<span class="n">band</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1"># add 1 sigma quantile</span>
<span class="n">band</span><span class="o">.</span><span class="n">shade</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="c1"># add wider quantile (0.01 .. 0.99)</span>
<span class="n">band</span><span class="o">.</span><span class="n">shade</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.49</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example-sine-highd_27_0.png" src="_images/example-sine-highd_27_0.png" />
</div>
</div>
</section>
<section id="Model-comparison">
<h2>Model comparison<a class="headerlink" href="#Model-comparison" title="Permalink to this heading"></a></h2>
<p>We now want to know:</p>
<p><strong>Is the model with 2 components better than the model with one component?</strong></p>
<p>What do we mean by “better” (“it fits better”, “the second component is significant”)?</p>
<ol class="loweralpha simple">
<li><p>Which model is better at predicting data it has not seen yet?</p></li>
<li><p>Which model is more probably the true one, given this data, and these models (and their parameter spaces)?</p></li>
<li><p>Which model is simplest, but complex enough to capture the information complexity of the data?</p></li>
</ol>
</section>
<section id="Bayesian-model-comparison">
<h2>Bayesian model comparison<a class="headerlink" href="#Bayesian-model-comparison" title="Permalink to this heading"></a></h2>
<p>Here we will focus on b, and apply Bayesian model comparison.</p>
<p>For simplicity, we will assume equal a-prior model probabilities.</p>
<p>The Bayes factor is:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result2</span><span class="p">[</span><span class="s1">&#39;logz&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">result1</span><span class="p">[</span><span class="s1">&#39;logz&#39;</span><span class="p">])</span>
<span class="n">K</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
448.08936178184297
</pre></div></div>
</div>
<p>This tells us, assuming both models are equally probable a-priori, that the 2-sine model is &gt;100 times more probable to be the true model than the 1-sine model.</p>
<p>N.B.: Bayes factors are influenced by parameter and model priors. It is a good idea to vary them and see how sensitive the result is. Here, the factor is extremely large, so we can be fairly confident that the 2-sine model is correct.</p>
<p>For making decisions, thresholds are needed. They can be calibrated to desired low false decisions rates with simulations (generate data under the simpler model, look at K distribution).</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="example-sine-modelcomparison.html" class="btn btn-neutral float-left" title="Model comparison" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="example-intrinsic-distribution.html" class="btn btn-neutral float-right" title="Tutorial: intrinsic distribution" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014-2022, Johannes Buchner.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>