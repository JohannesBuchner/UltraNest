<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Warm starting &mdash; UltraNest 4.3.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/nbsphinx-code-cells.css" />

  
    <link rel="shortcut icon" href="_static/icon.ico"/>
    <link rel="canonical" href="https://johannesbuchner.github.io/UltraNest/example-warmstart.html" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=0503a316"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Debugging techniques" href="debugging.html" />
    <link rel="prev" title="Bayesian workflow" href="example-sine-bayesian-workflow.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="index.html" class="icon icon-home">
            UltraNest
              <img src="_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                4.3.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="readme.html">UltraNest</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="method.html">Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="using-ultranest.html">Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="priors.html">Specifying priors</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="API.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="issues.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">Release Notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="example-sine-line.html">Time series fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="example-sine-modelcomparison.html">Model comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="example-sine-highd.html">Higher-dimensional fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="example-intrinsic-distribution.html">Tutorial: intrinsic distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="example-line.html">Tutorial: fitting a line</a></li>
<li class="toctree-l1"><a class="reference internal" href="example-outliers.html">Tutorial: distribution with outliers</a></li>
<li class="toctree-l1"><a class="reference internal" href="example-sine-bayesian-workflow.html">Bayesian workflow</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Warm starting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Black-body-model">Black body model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Generate-some-data">Generate some data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Visualise-the-data">Visualise the data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Prior">Prior</a></li>
<li class="toctree-l3"><a class="reference internal" href="#First-simple-model">First simple model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Plot-the-fit">Plot the fit</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Warm-starting-a-modified-model">Warm starting a modified model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Speed-up">Speed-up</a></li>
<li class="toctree-l2"><a class="reference internal" href="#How-it-works-&amp;-Limitations">How it works &amp; Limitations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Warm-starting-from-posterior-samples">Warm starting from posterior samples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#When-the-transform-cannot-be-inverted-easily">When the transform cannot be inverted easily</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Writing-a-run-file-for-warm-start">Writing a run file for warm start</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging techniques</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">UltraNest</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Warm starting</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Warm-starting">
<h1>Warm starting<a class="headerlink" href="#Warm-starting" title="Link to this heading"></a></h1>
<p>In this tutorial you will learn:</p>
<ul class="simple">
<li><p>How to play with model variations</p></li>
<li><p>Warm start feature: How UltraNest can resume and reuse an existing run, even if you modified the data/likelihood</p></li>
</ul>
<p>As a simple example, lets say we want to fit a black body.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">pi</span><span class="p">,</span> <span class="n">log</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<section id="Black-body-model">
<h2>Black body model<a class="headerlink" href="#Black-body-model" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Temperature&#39;</span><span class="p">,</span> <span class="s1">&#39;Amplitude&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">black_body_model</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">ampl</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">over</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ampl</span> <span class="o">/</span> <span class="n">wavelength</span><span class="o">**</span><span class="mi">5</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">wavelength</span><span class="o">*</span><span class="n">T</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="Generate-some-data">
<h3>Generate some data<a class="headerlink" href="#Generate-some-data" title="Link to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Ndata</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">wavelength</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Ndata</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ampl_true</span> <span class="o">=</span> <span class="mf">42.0</span>
<span class="n">T_true</span> <span class="o">=</span> <span class="mf">0.01</span>  <span class="c1"># in um^-1</span>
<span class="n">background_true</span> <span class="o">=</span> <span class="mf">1e-9</span>
<span class="n">y_true</span> <span class="o">=</span> <span class="n">black_body_model</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">ampl_true</span><span class="p">,</span> <span class="n">T_true</span><span class="p">)</span>
<span class="n">sigma_true</span> <span class="o">=</span> <span class="n">y_true</span> <span class="o">*</span> <span class="mf">0.1</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">y_true</span> <span class="o">+</span> <span class="n">background_true</span><span class="p">,</span> <span class="n">sigma_true</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">Ndata</span><span class="p">)</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">y_true</span> <span class="o">*</span> <span class="mf">0.1</span>
</pre></div>
</div>
</div>
</section>
<section id="Visualise-the-data">
<h3>Visualise the data<a class="headerlink" href="#Visualise-the-data" title="Link to this heading"></a></h3>
<p>Lets plot the data first to see what is going on:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_obs</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">y_true</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Spectral flux density [Jy]&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Wavelength [$\mu$m]&#39;</span><span class="p">);</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example-warmstart_9_0.png" src="_images/example-warmstart_9_0.png" />
</div>
</div>
</section>
<section id="Prior">
<h3>Prior<a class="headerlink" href="#Prior" title="Link to this heading"></a></h3>
<p>Here we intentionally set very wide priors:</p>
<ul class="simple">
<li><p>a uniform prior on temperature, and</p></li>
<li><p>a very wide log-uniform prior on the normalisation.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">prior_transform</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">z</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Prior predictive checks&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_obs</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_obs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">T</span><span class="p">,</span> <span class="n">ampl</span> <span class="o">=</span> <span class="n">prior_transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)))</span>
    <span class="n">y_predicted</span> <span class="o">=</span> <span class="n">black_body_model</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">ampl</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">y_predicted</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Spectral flux density [Jy]&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength [$</span><span class="se">\\</span><span class="s1">mu$m]&#39;</span><span class="p">);</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example-warmstart_13_0.png" src="_images/example-warmstart_13_0.png" />
</div>
</div>
</section>
<section id="First-simple-model">
<h3>First simple model<a class="headerlink" href="#First-simple-model" title="Link to this heading"></a></h3>
<p>Here is a typical gaussian likelihood with our black body function:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">T</span><span class="p">,</span> <span class="n">ampl</span> <span class="o">=</span> <span class="n">params</span>
    <span class="n">y_predicted</span> <span class="o">=</span> <span class="n">black_body_model</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">ampl</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">y_predicted</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">y_obs</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ultranest</span> <span class="kn">import</span> <span class="n">ReactiveNestedSampler</span>

<span class="n">reference_run_folder</span> <span class="o">=</span> <span class="s1">&#39;blackbody-alldata&#39;</span>
<span class="n">sampler_ref</span> <span class="o">=</span> <span class="n">ReactiveNestedSampler</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">log_likelihood</span><span class="p">,</span> <span class="n">prior_transform</span><span class="p">,</span> <span class="n">log_dir</span><span class="o">=</span><span class="n">reference_run_folder</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="s1">&#39;overwrite&#39;</span><span class="p">)</span>
<span class="n">results_ref</span> <span class="o">=</span> <span class="n">sampler_ref</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">frac_remain</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">sampler_ref</span><span class="o">.</span><span class="n">print_results</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ultranest] Sampling 400 live points from prior ...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "74a0712aa182456fa12822d7251d85ef", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ultranest] Explored until L=2e+02  7 [173.9047..173.9128]*| it/evals=6080/46921 eff=13.0694% N=400    400  400 400
[ultranest] Likelihood function evaluations: 46953
[ultranest] Writing samples and results to disk ...
[ultranest] Writing samples and results to disk ... done
[ultranest]   logZ = 159.8 +- 0.1527
[ultranest] Effective samples strategy satisfied (ESS = 981.1, need &gt;400)
[ultranest] Posterior uncertainty strategy is satisfied (KL: 0.46+-0.06 nat, need &lt;0.50 nat)
[ultranest] Evidency uncertainty strategy is satisfied (dlogz=0.43, need &lt;0.5)
[ultranest]   logZ error budget: single: 0.19 bs:0.15 tail:0.41 total:0.43 required:&lt;0.50
[ultranest] done iterating.

logZ = 159.705 +- 0.538
  single instance: logZ = 159.705 +- 0.186
  bootstrapped   : logZ = 159.775 +- 0.353
  tail           : logZ = +- 0.406
insert order U test : converged: True correlation: inf iterations

    Temperature         : 0.00945│ ▁▁▁▁▁▁▁▁▂▂▂▂▄▅▄▅▅▇▇▅▆▅▅▃▃▂▂▂▁▁▁▁▁▁▁ ▁ │0.01035    0.00989 +- 0.00012
    Amplitude           : 37.2  │ ▁▁▁▁▁▁▁▂▂▃▃▅▄▅▆▆▇▇▆▆▄▄▃▃▂▂▁▁▁▁▁▁▁▁▁▁▁ │59.7      47.4 +- 2.7

</pre></div></div>
</div>
</section>
<section id="Plot-the-fit">
<h3>Plot the fit<a class="headerlink" href="#Plot-the-fit" title="Link to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_obs</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">ultranest.plot</span> <span class="kn">import</span> <span class="n">PredictionBand</span>
<span class="n">band</span> <span class="o">=</span> <span class="n">PredictionBand</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span>
<span class="k">for</span> <span class="n">T</span><span class="p">,</span> <span class="n">ampl</span> <span class="ow">in</span> <span class="n">results_ref</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]:</span>
    <span class="n">band</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">black_body_model</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">ampl</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
<span class="n">band</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">band</span><span class="o">.</span><span class="n">shade</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Spectral flux density [Jy]&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength [$</span><span class="se">\\</span><span class="s1">mu$m]&#39;</span><span class="p">);</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example-warmstart_18_0.png" src="_images/example-warmstart_18_0.png" />
</div>
</div>
</section>
</section>
<section id="Warm-starting-a-modified-model">
<h2>Warm starting a modified model<a class="headerlink" href="#Warm-starting-a-modified-model" title="Link to this heading"></a></h2>
<p>Lets say we alter our model slightly. We include a small constant background:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">log_likelihood_with_background</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">T</span><span class="p">,</span> <span class="n">ampl</span> <span class="o">=</span> <span class="n">params</span>
    <span class="n">y_predicted</span> <span class="o">=</span> <span class="n">black_body_model</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">ampl</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-9</span>
    <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">y_predicted</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">y_obs</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<p>We have the same parameters, and expect results to be only mildly different. So lets use <strong>warm starting</strong>.</p>
<p>Using the previous reference run output file …</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">posterior_upoints_file</span> <span class="o">=</span> <span class="n">reference_run_folder</span> <span class="o">+</span> <span class="s1">&#39;/chains/weighted_post_untransformed.txt&#39;</span>
</pre></div>
</div>
</div>
<p>We define our accelerated likelihood and prior transform:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ultranest.integrator</span> <span class="kn">import</span> <span class="n">warmstart_from_similar_file</span>

<span class="n">aux_paramnames</span><span class="p">,</span> <span class="n">aux_log_likelihood</span><span class="p">,</span> <span class="n">aux_prior_transform</span><span class="p">,</span> <span class="n">vectorized</span> <span class="o">=</span> <span class="n">warmstart_from_similar_file</span><span class="p">(</span>
    <span class="n">posterior_upoints_file</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">log_likelihood_with_background</span><span class="p">,</span> <span class="n">prior_transform</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<p>Make accelerated run:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sampler</span> <span class="o">=</span> <span class="n">ReactiveNestedSampler</span><span class="p">(</span><span class="n">aux_paramnames</span><span class="p">,</span> <span class="n">aux_log_likelihood</span><span class="p">,</span> <span class="n">aux_prior_transform</span><span class="p">,</span> <span class="n">vectorized</span><span class="o">=</span><span class="n">vectorized</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">frac_remain</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ultranest] Sampling 400 live points from prior ...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "0eb4138742fd484683ad88f6385be5fa", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ultranest] Explored until L=2e+02  5 [169.4613..169.4636]*| it/evals=1600/5358 eff=32.2711% N=400
[ultranest] Likelihood function evaluations: 5393
[ultranest]   logZ = 166.7 +- 0.0473
[ultranest] Effective samples strategy satisfied (ESS = 763.2, need &gt;400)
[ultranest] Posterior uncertainty strategy is satisfied (KL: 0.45+-0.08 nat, need &lt;0.50 nat)
[ultranest] Evidency uncertainty strategy is satisfied (dlogz=0.41, need &lt;0.5)
[ultranest]   logZ error budget: single: 0.08 bs:0.05 tail:0.41 total:0.41 required:&lt;0.50
[ultranest] done iterating.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_obs</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">ultranest.plot</span> <span class="kn">import</span> <span class="n">PredictionBand</span>
<span class="n">band</span> <span class="o">=</span> <span class="n">PredictionBand</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span>
<span class="k">for</span> <span class="n">T</span><span class="p">,</span> <span class="n">ampl</span> <span class="ow">in</span> <span class="n">results_ref</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]:</span>
    <span class="n">band</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">black_body_model</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">ampl</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
<span class="n">band</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">band</span><span class="o">.</span><span class="n">shade</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">band</span> <span class="o">=</span> <span class="n">PredictionBand</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span>
<span class="k">for</span> <span class="n">T</span><span class="p">,</span> <span class="n">ampl</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]:</span>
    <span class="n">band</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">black_body_model</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">ampl</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
<span class="n">band</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">band</span><span class="o">.</span><span class="n">shade</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">y_true</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Spectral flux density [Jy]&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength [$</span><span class="se">\\</span><span class="s1">mu$m]&#39;</span><span class="p">);</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example-warmstart_28_0.png" src="_images/example-warmstart_28_0.png" />
</div>
</div>
</section>
<section id="Speed-up">
<h2>Speed-up<a class="headerlink" href="#Speed-up" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Speed-up of warm-start: </span><span class="si">%d%%</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">((</span><span class="n">results_ref</span><span class="p">[</span><span class="s1">&#39;ncall&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;ncall&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Speed-up of warm-start: 770%
</pre></div></div>
</div>
<p>The cost savings are higher, the more similar the posterior of the modified run is to the original run. This speed-up increases drastically if you have highly informative posteriors. This benefit is <em>independent of problem dimension</em>.</p>
</section>
<section id="How-it-works-&amp;-Limitations">
<h2>How it works &amp; Limitations<a class="headerlink" href="#How-it-works-&-Limitations" title="Link to this heading"></a></h2>
<p>Warm-starting works by deforming the parameter space. The prior transform function is adjusted, and the adjustment is removed by reweighting the likelihood function, to produce the same posterior. To make this work, posterior samples from the unit cube space are required. The deformation uses a factorized auxiliary distribution, based on marginal posterior quantiles.</p>
<p>The weighted_post_untransformed.txt file from a hot-started run cannot be used. This is because it has a deformation already applied.</p>
<p>Read the full documentation at * <a class="reference external" href="https://johannesbuchner.github.io/UltraNest/ultranest.html#ultranest.integrator.warmstart_from_similar_file">warmstart_from_similar_file</a> and * the underlying <a class="reference external" href="https://johannesbuchner.github.io/UltraNest/ultranest.html#ultranest.hotstart.get_auxiliary_contbox_parameterization">get_auxiliary_contbox_parameterization</a> function</p>
</section>
<section id="Warm-starting-from-posterior-samples">
<h2>Warm starting from posterior samples<a class="headerlink" href="#Warm-starting-from-posterior-samples" title="Link to this heading"></a></h2>
<p>If you already have posterior samples, then you can create an appropriate weighted_post_untransformed.txt file. However, the inverse of the prior transformation has to be applied.</p>
<p>In some cases, this is easy to do analytically, e.g., for uniform priors it is just a scaling.</p>
<section id="When-the-transform-cannot-be-inverted-easily">
<h3>When the transform cannot be inverted easily<a class="headerlink" href="#When-the-transform-cannot-be-inverted-easily" title="Link to this heading"></a></h3>
<p>The following code works for arbitrary, factorized priors (as in the blackbody example in this notebook), for an arbitrary number of parameters.</p>
<p>Lets start with our posterior samples. These could be obtained posterior samples from MCMC, or generated from the parameter errors quoted in a paper. Here we take it from the reference run:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">posterior_samples</span> <span class="o">=</span> <span class="n">results_ref</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">posterior_samples</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">posterior_samples</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (p-space)&#39;</span> <span class="o">%</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (p-space)&#39;</span> <span class="o">%</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example-warmstart_36_0.png" src="_images/example-warmstart_36_0.png" />
</div>
</div>
<p>Lets have a look how our unit-cube prior transform works:</p>
<p>The first parameter has a uniform prior, the other a log-uniform prior.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">uguess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mi">40000</span><span class="p">)</span>
<span class="n">pguess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">prior_transform</span><span class="p">(</span><span class="n">ui</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)))</span> <span class="k">for</span> <span class="n">ui</span> <span class="ow">in</span> <span class="n">uguess</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">uguess</span><span class="p">,</span> <span class="n">pguess</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;u-space (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;p-space (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">uguess</span><span class="p">,</span> <span class="n">pguess</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;u-space (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;p-space (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example-warmstart_39_0.png" src="_images/example-warmstart_39_0.png" />
</div>
</div>
<p>Here we convert the posterior samples to u-space, by finding the unit-cube value by optimization.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.optimize</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tqdm</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nparams</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nparams</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
<span class="n">stdevs</span> <span class="o">=</span> <span class="n">posterior_samples</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">minfunc</span><span class="p">(</span><span class="n">ui</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">pi</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">ui</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="mf">1e100</span>
    <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ui</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">prior_transform</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

<span class="n">usamples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">posterior_samples</span><span class="p">),</span> <span class="n">nparams</span><span class="p">))</span>
<span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">sample</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">posterior_samples</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
        <span class="n">ui0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pguess</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">uguess</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span>
            <span class="n">minfunc</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">sample</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
            <span class="n">method</span><span class="o">=</span><span class="s1">&#39;brent&#39;</span><span class="p">,</span>
            <span class="n">bracket</span><span class="o">=</span><span class="p">(</span><span class="n">ui0</span> <span class="o">-</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">ui0</span><span class="p">,</span> <span class="n">ui0</span> <span class="o">+</span> <span class="mf">1e-4</span><span class="p">),</span>
            <span class="n">tol</span><span class="o">=</span><span class="mf">0.001</span> <span class="o">*</span> <span class="n">stdevs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">usamples</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|████████████████████████████████████| 6505/6505 [00:00&lt;00:00, 12544.08it/s]
</pre></div></div>
</div>
<p>Lets see whether our untransformed (u-space) posterior samples are correct:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="n">results_ref</span><span class="p">[</span><span class="s1">&#39;weighted_samples&#39;</span><span class="p">][</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">results_ref</span><span class="p">[</span><span class="s1">&#39;weighted_samples&#39;</span><span class="p">][</span><span class="s1">&#39;upoints&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">results_ref</span><span class="p">[</span><span class="s1">&#39;weighted_samples&#39;</span><span class="p">][</span><span class="s1">&#39;upoints&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;reference run&#39;</span><span class="p">);</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">usamples</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">usamples</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;modified run, usamples reconstructed&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;u-space (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;u-space (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example-warmstart_45_0.png" src="_images/example-warmstart_45_0.png" />
</div>
</div>
<p>This looks like great agreement! We successfully untransformed the posterior samples to u-space.</p>
</section>
<section id="Writing-a-run-file-for-warm-start">
<h3>Writing a run file for warm start<a class="headerlink" href="#Writing-a-run-file-for-warm-start" title="Link to this heading"></a></h3>
<p>We write a weighted_post_untransformed.txt file based on our untransformed posterior samples. Since these are equally weighted, the first two columns are constants.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">usamples</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">usamples</span><span class="p">)</span>
<span class="n">logl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">usamples</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span>
    <span class="s1">&#39;custom-weighted_post_untransformed.txt&#39;</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">weights</span><span class="p">,</span> <span class="n">logl</span><span class="p">,</span> <span class="n">usamples</span><span class="p">)),</span>
    <span class="n">header</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="s1">&#39;logl&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">parameters</span><span class="p">),</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%f</span><span class="s1">&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>head<span class="w"> </span>custom-weighted_post_untransformed.txt
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# weight logl Temperature Amplitude
0.000154 0.000000 0.009828 0.584218
0.000154 0.000000 0.009933 0.582950
0.000154 0.000000 0.009911 0.583998
0.000154 0.000000 0.010134 0.580971
0.000154 0.000000 0.009717 0.585696
0.000154 0.000000 0.009823 0.584407
0.000154 0.000000 0.009729 0.585907
0.000154 0.000000 0.009938 0.582713
0.000154 0.000000 0.009849 0.582950
</pre></div></div>
</div>
<p>We can now point the warmstart_from_similar_file function at this file.</p>
</section>
</section>
<section id="Conclusion">
<h2>Conclusion<a class="headerlink" href="#Conclusion" title="Link to this heading"></a></h2>
<p>Warm start allows accelerated computation based on already knowing the posterior peak approximately. This allows you to:</p>
<ul class="simple">
<li><p>vary the data (change the analysis pipeline)</p></li>
<li><p>vary model assumptions</p></li>
</ul>
<p>without needing to start the computation from scratch (potentially costly).</p>
<p>These features are experimental and feedback is appreciated. It is recommended to do a full, clean run to obtain final, reliable results before publication.</p>
<p>References: * “SuperNest” by Aleksandr Petrosyan and Will Handley <a class="reference external" href="https://arxiv.org/abs/2212.01760">https://arxiv.org/abs/2212.01760</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="example-sine-bayesian-workflow.html" class="btn btn-neutral float-left" title="Bayesian workflow" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="debugging.html" class="btn btn-neutral float-right" title="Debugging techniques" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014-2024, Johannes Buchner.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>