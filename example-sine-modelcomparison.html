

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Model comparison &mdash; UltraNest 2.1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/icon.ico"/>
  
  
  
    <link rel="canonical" href="https://johannesbuchner.github.io/UltraNest/example-sine-modelcomparison.html"/>
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Higher-dimensional fitting" href="example-sine-highd.html" />
    <link rel="prev" title="Time series fitting" href="example-sine-line.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >
          

          
            <a href="index.html" class="icon icon-home"> UltraNest
          

          
            
            <img src="_static/logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="readme.html">UltraNest</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="method.html">Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage-spectral-line.html">Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">Tour of the features</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="issues.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">Release Notes</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="example-sine-line.html">Time series fitting</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Model comparison</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Model">Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Generating-data">Generating data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Visualise-the-data">Visualise the data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Plot-the-parameter-posterior-probability-distribution">Plot the parameter posterior probability distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Plot-the-fit:">Plot the fit:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Model-comparison-methods">Model comparison methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Bayesian-model-comparison">Bayesian model comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Calibrating-Bayes-factor-thresholds">Calibrating Bayes factor thresholds</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Further-reading">Further reading</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example-sine-highd.html">Higher-dimensional fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="example-intrinsic-distribution.html">Tutorial: intrinsic distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="example-line.html">Tutorial: fitting a line</a></li>
<li class="toctree-l1"><a class="reference internal" href="example-outliers.html">Tutorial: distribution with outliers</a></li>
<li class="toctree-l1"><a class="reference internal" href="example-sine-bayesian-workflow.html">Bayesian workflow</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">UltraNest</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Model comparison</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Model-comparison">
<h1>Model comparison<a class="headerlink" href="#Model-comparison" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Model">
<h2>Model<a class="headerlink" href="#Model" title="Permalink to this headline">¶</a></h2>
<p>We again consider the sine model with gaussian measurement errors.</p>
<div class="math notranslate nohighlight">
\[y = A_1 \sin\left(2 \pi \left(\frac{t}{P_1} + t_1\right)\right) + B + \epsilon\]</div>
<p>where <span class="math notranslate nohighlight">\(\epsilon \sim \mathrm{Normal}(0, \sigma)\)</span></p>
<p>We want to test if this is preferred over pure noise.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">pi</span><span class="p">,</span> <span class="n">sin</span>

<span class="k">def</span> <span class="nf">sine_model1</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">t1</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">A1</span> <span class="o">*</span> <span class="n">sin</span><span class="p">((</span><span class="n">t</span> <span class="o">/</span> <span class="n">P1</span> <span class="o">+</span> <span class="n">t1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">B</span>

<span class="k">def</span> <span class="nf">sine_model0</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">B</span> <span class="o">+</span> <span class="n">t</span><span class="o">*</span><span class="mi">0</span>
</pre></div>
</div>
</div>
<p>The model has four unknown parameters per component:</p>
<ul class="simple">
<li><p>the signal offset <span class="math notranslate nohighlight">\(B\)</span></p></li>
<li><p>the amplitude <span class="math notranslate nohighlight">\(A\)</span></p></li>
<li><p>the period <span class="math notranslate nohighlight">\(P\)</span></p></li>
<li><p>the time offset <span class="math notranslate nohighlight">\(t_0\)</span></p></li>
</ul>
</div>
<div class="section" id="Generating-data">
<h2>Generating data<a class="headerlink" href="#Generating-data" title="Permalink to this headline">¶</a></h2>
<p>Lets generate some data following this model:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="n">n_data</span> <span class="o">=</span> <span class="mi">50</span>

<span class="c1"># time of observations</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_data</span><span class="p">)</span>
<span class="c1"># measurement values</span>
<span class="n">yerr</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">sine_model1</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">A1</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">P1</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">t1</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">yerr</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<div class="section" id="Visualise-the-data">
<h2>Visualise the data<a class="headerlink" href="#Visualise-the-data" title="Permalink to this headline">¶</a></h2>
<p>Lets plot the data first to see what is going on:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span>
             <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">t_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example-sine-modelcomparison_6_0.png" src="_images/example-sine-modelcomparison_6_0.png" />
</div>
</div>
<p>A beautiful noisy data set, with some hints of a modulation.</p>
<p>Now the question is: what model parameters are allowed under these data?</p>
<p>First, we need to define the parameter ranges through a prior:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">parameters1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;A1&#39;</span><span class="p">,</span> <span class="s1">&#39;P1&#39;</span><span class="p">,</span> <span class="s1">&#39;t1&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">prior_transform1</span><span class="p">(</span><span class="n">cube</span><span class="p">):</span>
    <span class="c1"># the argument, cube, consists of values from 0 to 1</span>
    <span class="c1"># we have to convert them to physical scales</span>

    <span class="n">params</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># let background level go from -10 to +10</span>
    <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">-</span> <span class="mi">10</span>
    <span class="c1"># let amplitude go from 0.1 to 100</span>
    <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">cube</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># let period go from 0.3 to 30</span>
    <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">cube</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># let time go from 0 to 1</span>
    <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">params</span>

<span class="n">parameters0</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">prior_transform0</span><span class="p">(</span><span class="n">cube</span><span class="p">):</span>
    <span class="c1"># the argument, cube, consists of values from 0 to 1</span>
    <span class="c1"># we have to convert them to physical scales</span>

    <span class="n">params</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># let background level go from -10 to +10</span>
    <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">-</span> <span class="mi">10</span>
    <span class="k">return</span> <span class="n">params</span>

</pre></div>
</div>
</div>
<p>Define the likelihood, which measures how far the data are from the model predictions. More precisely, how often the parameters would arise under the given parameters. We assume gaussian measurement errors of known size (yerr).</p>
<div class="math notranslate nohighlight">
\[\chi^2 = \sum\left(\frac{m_i-y_i}{\sigma}\right)^2\]</div>
<div class="math notranslate nohighlight">
\[\log \cal{L} = -\chi^2 / 2\]</div>
<p>where the model is the sine_model function from above at time <span class="math notranslate nohighlight">\(t_i\)</span>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">scipy.stats</span>

<span class="k">def</span> <span class="nf">log_likelihood1</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="c1"># unpack the current parameters:</span>
    <span class="n">B</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">t1</span> <span class="o">=</span> <span class="n">params</span>

    <span class="c1"># compute for each x point, where it should lie in y</span>
    <span class="n">y_model</span> <span class="o">=</span> <span class="n">sine_model1</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="n">B</span><span class="p">,</span> <span class="n">A1</span><span class="o">=</span><span class="n">A1</span><span class="p">,</span> <span class="n">P1</span><span class="o">=</span><span class="n">P1</span><span class="p">,</span> <span class="n">t1</span><span class="o">=</span><span class="n">t1</span><span class="p">)</span>
    <span class="c1"># compute likelihood</span>
    <span class="n">loglike</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(((</span><span class="n">y_model</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">yerr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">loglike</span>

<span class="k">def</span> <span class="nf">log_likelihood0</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">B</span><span class="p">,</span> <span class="o">=</span> <span class="n">params</span>

    <span class="n">y_model</span> <span class="o">=</span> <span class="n">sine_model0</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="n">B</span><span class="p">)</span>
    <span class="c1"># compute likelihood</span>
    <span class="n">loglike</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(((</span><span class="n">y_model</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">yerr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">loglike</span>
</pre></div>
</div>
</div>
<p>Solve the problem:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">ultranest</span>

<span class="n">sampler1</span> <span class="o">=</span> <span class="n">ultranest</span><span class="o">.</span><span class="n">ReactiveNestedSampler</span><span class="p">(</span><span class="n">parameters1</span><span class="p">,</span> <span class="n">log_likelihood1</span><span class="p">,</span> <span class="n">prior_transform1</span><span class="p">)</span>

<span class="n">sampler0</span> <span class="o">=</span> <span class="n">ultranest</span><span class="o">.</span><span class="n">ReactiveNestedSampler</span><span class="p">(</span><span class="n">parameters0</span><span class="p">,</span> <span class="n">log_likelihood0</span><span class="p">,</span> <span class="n">prior_transform0</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">result1</span> <span class="o">=</span> <span class="n">sampler1</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">min_num_live_points</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">sampler1</span><span class="o">.</span><span class="n">print_results</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ultranest] Sampling 400 live points from prior ...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "443718ae0f234a01b8cd4e414d7cbb79", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ultranest] Explored until L=-2e+01   [-20.7338..-20.7331]*| it/evals=6642/99344 eff=6.7129% N=400 400
[ultranest] Likelihood function evaluations: 99353
[ultranest]   logZ = -32.68 +- 0.1148
[ultranest] Effective samples strategy satisfied (ESS = 2537.6, need &gt;400)
[ultranest] Posterior uncertainty strategy is satisfied (KL: 0.46+-0.06 nat, need &lt;0.50 nat)
[ultranest] Evidency uncertainty strategy is satisfied (dlogz=0.30, need &lt;0.5)
[ultranest]   logZ error budget: single: 0.15 bs:0.11 tail:0.01 total:0.12 required:&lt;0.50
[ultranest] done iterating.

logZ = -32.686 +- 0.260
  single instance: logZ = -32.686 +- 0.154
  bootstrapped   : logZ = -32.681 +- 0.260
  tail           : logZ = +- 0.010

    B                   1.03 +- 0.32
    A1                  0.89 +- 0.34
    P1                  3.9 +- 6.7
    t1                  0.46 +- 0.44
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">result0</span> <span class="o">=</span> <span class="n">sampler0</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">min_num_live_points</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">sampler0</span><span class="o">.</span><span class="n">print_results</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ultranest] Sampling 400 live points from prior ...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c9736b2f0f4e4151ac4d8b829dd89021", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ultranest] Explored until L=-3e+01   [-31.7138..-31.7138]*| it/evals=2920/3406 eff=97.1391% N=400 0
[ultranest] Likelihood function evaluations: 3435
[ultranest]   logZ = -35.72 +- 0.07079
[ultranest] Effective samples strategy satisfied (ESS = 1266.0, need &gt;400)
[ultranest] Posterior uncertainty strategy is satisfied (KL: 0.46+-0.07 nat, need &lt;0.50 nat)
[ultranest] Evidency uncertainty strategy is satisfied (dlogz=0.16, need &lt;0.5)
[ultranest]   logZ error budget: single: 0.09 bs:0.07 tail:0.03 total:0.08 required:&lt;0.50
[ultranest] done iterating.

logZ = -35.710 +- 0.160
  single instance: logZ = -35.710 +- 0.094
  bootstrapped   : logZ = -35.722 +- 0.156
  tail           : logZ = +- 0.034

    B                   1.15 +- 0.14
</pre></div></div>
</div>
</div>
<div class="section" id="Plot-the-parameter-posterior-probability-distribution">
<h2>Plot the parameter posterior probability distribution<a class="headerlink" href="#Plot-the-parameter-posterior-probability-distribution" title="Permalink to this headline">¶</a></h2>
<p>A classic corner plot:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">ultranest.plot</span> <span class="k">import</span> <span class="n">cornerplot</span>
<span class="n">cornerplot</span><span class="p">(</span><span class="n">result1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example-sine-modelcomparison_16_0.png" src="_images/example-sine-modelcomparison_16_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cornerplot</span><span class="p">(</span><span class="n">result0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example-sine-modelcomparison_17_0.png" src="_images/example-sine-modelcomparison_17_0.png" />
</div>
</div>
<p>If you want, you can also play with the posterior as a pandas frame:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">result1</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">result1</span><span class="p">[</span><span class="s1">&#39;paramnames&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>A1</th>
      <th>P1</th>
      <th>t1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>count</td>
      <td>7047.000000</td>
      <td>7047.000000</td>
      <td>7047.000000</td>
      <td>7047.000000</td>
    </tr>
    <tr>
      <td>mean</td>
      <td>1.031719</td>
      <td>0.889383</td>
      <td>3.928380</td>
      <td>0.463131</td>
    </tr>
    <tr>
      <td>std</td>
      <td>0.320323</td>
      <td>0.337931</td>
      <td>6.655103</td>
      <td>0.438961</td>
    </tr>
    <tr>
      <td>min</td>
      <td>-2.254976</td>
      <td>0.101163</td>
      <td>1.034575</td>
      <td>0.000046</td>
    </tr>
    <tr>
      <td>25%</td>
      <td>0.909554</td>
      <td>0.722280</td>
      <td>2.887038</td>
      <td>0.044096</td>
    </tr>
    <tr>
      <td>50%</td>
      <td>1.013514</td>
      <td>0.876311</td>
      <td>3.036552</td>
      <td>0.144829</td>
    </tr>
    <tr>
      <td>75%</td>
      <td>1.118239</td>
      <td>1.035640</td>
      <td>3.199337</td>
      <td>0.950620</td>
    </tr>
    <tr>
      <td>max</td>
      <td>7.994730</td>
      <td>7.237188</td>
      <td>98.909077</td>
      <td>0.999950</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="Plot-the-fit:">
<h2>Plot the fit:<a class="headerlink" href="#Plot-the-fit:" title="Permalink to this headline">¶</a></h2>
<p>To evaluate whether the results make any sense, we want to look whether the fitted function goes through the data points.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;1-sine fit&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span>
             <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>


<span class="n">t_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">ultranest.plot</span> <span class="k">import</span> <span class="n">PredictionBand</span>
<span class="n">band</span> <span class="o">=</span> <span class="n">PredictionBand</span><span class="p">(</span><span class="n">t_grid</span><span class="p">)</span>

<span class="c1"># go through the solutions</span>
<span class="k">for</span> <span class="n">B</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">t1</span> <span class="ow">in</span> <span class="n">sampler1</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]:</span>
    <span class="c1"># compute for each time the y value</span>
    <span class="n">band</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sine_model1</span><span class="p">(</span><span class="n">t_grid</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="n">B</span><span class="p">,</span> <span class="n">A1</span><span class="o">=</span><span class="n">A1</span><span class="p">,</span> <span class="n">P1</span><span class="o">=</span><span class="n">P1</span><span class="p">,</span> <span class="n">t1</span><span class="o">=</span><span class="n">t1</span><span class="p">))</span>

<span class="n">band</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1"># add 1 sigma quantile</span>
<span class="n">band</span><span class="o">.</span><span class="n">shade</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="c1"># add wider quantile (0.01 .. 0.99)</span>
<span class="n">band</span><span class="o">.</span><span class="n">shade</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.49</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>


</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.collections.PolyCollection at 0x7f8c1128a310&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example-sine-modelcomparison_22_1.png" src="_images/example-sine-modelcomparison_22_1.png" />
</div>
</div>
</div>
<div class="section" id="Model-comparison-methods">
<h2>Model comparison methods<a class="headerlink" href="#Model-comparison-methods" title="Permalink to this headline">¶</a></h2>
<p>We now want to know:</p>
<p><strong>Is the model with 2 components better than the model with one component?</strong></p>
<p>What do we mean by “better” (“it fits better”, “the component is significant”)?</p>
<ol class="loweralpha simple">
<li><p>Which model is better at predicting data it has not seen yet?</p></li>
<li><p>Which model is more probably the true one, given this data, these models, and their parameter spaces?</p></li>
<li><p>Which model is simplest, but complex enough to capture the information complexity of the data?</p></li>
</ol>
</div>
<div class="section" id="Bayesian-model-comparison">
<h2>Bayesian model comparison<a class="headerlink" href="#Bayesian-model-comparison" title="Permalink to this headline">¶</a></h2>
<p>Here we will focus on b, and apply Bayesian model comparison.</p>
<p>For simplicity, we will assume equal a-prior model probabilities.</p>
<p>The Bayes factor is:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result1</span><span class="p">[</span><span class="s1">&#39;logz&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">result0</span><span class="p">[</span><span class="s1">&#39;logz&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;K = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">K</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The 1-sine model is </span><span class="si">%.2f</span><span class="s2"> times more probable than the no-signal model&quot;</span> <span class="o">%</span> <span class="n">K</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;assuming the models are equally probable a priori.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
K = 20.56
The 1-sine model is 20.56 times more probable than the no-signal model
assuming the models are equally probable a priori.
</pre></div></div>
</div>
<p>N.B.: Bayes factors are influenced by parameter and model priors. It is a good idea to vary them and see how sensitive the result is.</p>
<p>For making decisions, thresholds are needed. They can be calibrated to desired low false decisions rates with simulations (generate data under the simpler model, look at K distribution).</p>
</div>
<div class="section" id="Calibrating-Bayes-factor-thresholds">
<h2>Calibrating Bayes factor thresholds<a class="headerlink" href="#Calibrating-Bayes-factor-thresholds" title="Permalink to this headline">¶</a></h2>
<p>Lets generate some data sets under the null hypothesis (noise-only model) and see how often we would get a large Bayes factor. For this, we need to fit with both models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;ultranest&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">FATAL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">K_simulated</span> <span class="o">=</span> <span class="p">[]</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;ultranest&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">handlers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">FATAL</span><span class="p">)</span>

<span class="c1"># go through 100 plausible parameters</span>
<span class="k">for</span> <span class="n">B</span> <span class="ow">in</span> <span class="n">sampler0</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]:</span>
    <span class="c1"># generate new data</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">sine_model0</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">yerr</span><span class="p">)</span>

    <span class="c1"># analyse with sine model</span>
    <span class="n">sampler1</span> <span class="o">=</span> <span class="n">ultranest</span><span class="o">.</span><span class="n">ReactiveNestedSampler</span><span class="p">(</span><span class="n">parameters1</span><span class="p">,</span> <span class="n">log_likelihood1</span><span class="p">,</span> <span class="n">prior_transform1</span><span class="p">)</span>
    <span class="n">Z1</span> <span class="o">=</span> <span class="n">sampler1</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">viz_callback</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;logz&#39;</span><span class="p">]</span>
    <span class="c1"># analyse with noise-only model</span>
    <span class="n">sampler0</span> <span class="o">=</span> <span class="n">ultranest</span><span class="o">.</span><span class="n">ReactiveNestedSampler</span><span class="p">(</span><span class="n">parameters0</span><span class="p">,</span> <span class="n">log_likelihood0</span><span class="p">,</span> <span class="n">prior_transform0</span><span class="p">)</span>
    <span class="n">Z0</span> <span class="o">=</span> <span class="n">sampler0</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">viz_callback</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;logz&#39;</span><span class="p">]</span>
    <span class="c1"># store Bayes factor</span>
    <span class="n">K_here</span> <span class="o">=</span> <span class="n">Z1</span> <span class="o">-</span> <span class="n">Z0</span>
    <span class="n">K_simulated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">K_here</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bayes factor: </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">K_here</span><span class="p">))</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Z=-22.6(96.75%) | Like=-18.44..-18.44 [-18.4423..-18.4423]*| it/evals=3040/3550 eff=96.5079% N=400 0  0
Bayes factor: 0.31
Z=-29.0(89.53%) | Like=-22.48..-21.23 [-22.4812..-22.4807]*| it/evals=3538/265463 eff=1.3348% N=400 00
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/user/.local/lib/python3.7/site-packages/ultranest-2.0.3-py3.7-linux-x86_64.egg/ultranest/integrator.py:1197: UserWarning: Sampling from region seems inefficient. You can try increasing nlive, frac_remain, dlogz, dKL, decrease min_ess). [0/40 accepted, it=2500]
  warnings.warn(&#34;Sampling from region seems inefficient. You can try increasing nlive, frac_remain, dlogz, dKL, decrease min_ess). [%d/%d accepted, it=%d]&#34; % (accepted.sum(), ndraw, nit))
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Z=-28.9(97.31%) | Like=-22.22..-21.19 [-22.2180..-22.2177]*| it/evals=4202/619627 eff=0.6786% N=400
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-15-b28743895319&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     11</span>     <span class="ansi-red-fg"># analyse with sine model</span>
<span class="ansi-green-intense-fg ansi-bold">     12</span>     sampler1 <span class="ansi-blue-fg">=</span> ultranest<span class="ansi-blue-fg">.</span>ReactiveNestedSampler<span class="ansi-blue-fg">(</span>parameters1<span class="ansi-blue-fg">,</span> log_likelihood1<span class="ansi-blue-fg">,</span> prior_transform1<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 13</span><span class="ansi-red-fg">     </span>Z1 <span class="ansi-blue-fg">=</span> sampler1<span class="ansi-blue-fg">.</span>run<span class="ansi-blue-fg">(</span>viz_callback<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;logz&#39;</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">     14</span>     <span class="ansi-red-fg"># analyse with noise-only model</span>
<span class="ansi-green-intense-fg ansi-bold">     15</span>     sampler0 <span class="ansi-blue-fg">=</span> ultranest<span class="ansi-blue-fg">.</span>ReactiveNestedSampler<span class="ansi-blue-fg">(</span>parameters0<span class="ansi-blue-fg">,</span> log_likelihood0<span class="ansi-blue-fg">,</span> prior_transform0<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/.local/lib/python3.7/site-packages/ultranest-2.0.3-py3.7-linux-x86_64.egg/ultranest/integrator.py</span> in <span class="ansi-cyan-fg">run</span><span class="ansi-blue-fg">(self, update_interval_iter_fraction, update_interval_ncall, log_interval, show_status, viz_callback, dlogz, dKL, frac_remain, Lepsilon, min_ess, max_iters, max_ncalls, max_num_improvement_loops, min_num_live_points, cluster_num_live_points)</span>
<span class="ansi-green-intense-fg ansi-bold">   1721</span>             cluster_num_live_points<span class="ansi-blue-fg">=</span>cluster_num_live_points<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   1722</span>             show_status<span class="ansi-blue-fg">=</span>show_status<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">-&gt; 1723</span><span class="ansi-red-fg">             </span>viz_callback<span class="ansi-blue-fg">=</span>viz_callback<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">   1724</span>         ):
<span class="ansi-green-intense-fg ansi-bold">   1725</span>             <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>log<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/.local/lib/python3.7/site-packages/ultranest-2.0.3-py3.7-linux-x86_64.egg/ultranest/integrator.py</span> in <span class="ansi-cyan-fg">run_iter</span><span class="ansi-blue-fg">(self, update_interval_iter_fraction, update_interval_ncall, log_interval, dlogz, dKL, frac_remain, Lepsilon, min_ess, max_iters, max_ncalls, max_num_improvement_loops, min_num_live_points, cluster_num_live_points, show_status, viz_callback)</span>
<span class="ansi-green-intense-fg ansi-bold">   1936</span>
<span class="ansi-green-intense-fg ansi-bold">   1937</span>                     <span class="ansi-red-fg"># sample point</span>
<span class="ansi-green-fg">-&gt; 1938</span><span class="ansi-red-fg">                     </span>u<span class="ansi-blue-fg">,</span> p<span class="ansi-blue-fg">,</span> L <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_create_point<span class="ansi-blue-fg">(</span>Lmin<span class="ansi-blue-fg">=</span>Lmin<span class="ansi-blue-fg">,</span> ndraw<span class="ansi-blue-fg">=</span>ndraw<span class="ansi-blue-fg">,</span> active_u<span class="ansi-blue-fg">=</span>active_u<span class="ansi-blue-fg">,</span> active_values<span class="ansi-blue-fg">=</span>active_values<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1939</span>                     child <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>pointpile<span class="ansi-blue-fg">.</span>make_node<span class="ansi-blue-fg">(</span>L<span class="ansi-blue-fg">,</span> u<span class="ansi-blue-fg">,</span> p<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1940</span>                     main_iterator<span class="ansi-blue-fg">.</span>Lmax <span class="ansi-blue-fg">=</span> max<span class="ansi-blue-fg">(</span>main_iterator<span class="ansi-blue-fg">.</span>Lmax<span class="ansi-blue-fg">,</span> L<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/.local/lib/python3.7/site-packages/ultranest-2.0.3-py3.7-linux-x86_64.egg/ultranest/integrator.py</span> in <span class="ansi-cyan-fg">_create_point</span><span class="ansi-blue-fg">(self, Lmin, ndraw, active_u, active_values)</span>
<span class="ansi-green-intense-fg ansi-bold">   1277</span>                 <span class="ansi-green-fg">while</span> ib <span class="ansi-blue-fg">&gt;=</span> len<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>samples<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1278</span>                     ib <span class="ansi-blue-fg">=</span> <span class="ansi-cyan-fg">0</span>
<span class="ansi-green-fg">-&gt; 1279</span><span class="ansi-red-fg">                     </span>self<span class="ansi-blue-fg">.</span>_refill_samples<span class="ansi-blue-fg">(</span>Lmin<span class="ansi-blue-fg">,</span> ndraw<span class="ansi-blue-fg">,</span> nit<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1280</span>                     nit <span class="ansi-blue-fg">+=</span> <span class="ansi-cyan-fg">1</span>
<span class="ansi-green-intense-fg ansi-bold">   1281</span>             <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/.local/lib/python3.7/site-packages/ultranest-2.0.3-py3.7-linux-x86_64.egg/ultranest/integrator.py</span> in <span class="ansi-cyan-fg">_refill_samples</span><span class="ansi-blue-fg">(self, Lmin, ndraw, nit)</span>
<span class="ansi-green-intense-fg ansi-bold">   1176</span>         <span class="ansi-blue-fg">&#34;&#34;&#34;Get new samples from region.&#34;&#34;&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">   1177</span>         nc <span class="ansi-blue-fg">=</span> <span class="ansi-cyan-fg">0</span>
<span class="ansi-green-fg">-&gt; 1178</span><span class="ansi-red-fg">         </span>u<span class="ansi-blue-fg">,</span> father <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>region<span class="ansi-blue-fg">.</span>sample<span class="ansi-blue-fg">(</span>nsamples<span class="ansi-blue-fg">=</span>ndraw<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1179</span>         <span class="ansi-green-fg">assert</span> np<span class="ansi-blue-fg">.</span>logical_and<span class="ansi-blue-fg">(</span>u <span class="ansi-blue-fg">&gt;</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">,</span> u <span class="ansi-blue-fg">&lt;</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>all<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">(</span>u<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1180</span>         nu <span class="ansi-blue-fg">=</span> u<span class="ansi-blue-fg">.</span>shape<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span>

<span class="ansi-green-fg">~/.local/lib/python3.7/site-packages/ultranest-2.0.3-py3.7-linux-x86_64.egg/ultranest/mlfriends.pyx</span> in <span class="ansi-cyan-fg">ultranest.mlfriends.MLFriends.sample</span><span class="ansi-blue-fg">()</span>

<span class="ansi-green-fg">~/.local/lib/python3.7/site-packages/ultranest-2.0.3-py3.7-linux-x86_64.egg/ultranest/mlfriends.pyx</span> in <span class="ansi-cyan-fg">ultranest.mlfriends.MLFriends.sample_from_points</span><span class="ansi-blue-fg">()</span>

<span class="ansi-green-fg">mtrand.pyx</span> in <span class="ansi-cyan-fg">numpy.random.mtrand.RandomState.randint</span><span class="ansi-blue-fg">()</span>

<span class="ansi-green-fg">_bounded_integers.pyx</span> in <span class="ansi-cyan-fg">numpy.random._bounded_integers._rand_int64</span><span class="ansi-blue-fg">()</span>

<span class="ansi-green-fg">&lt;__array_function__ internals&gt;</span> in <span class="ansi-cyan-fg">prod</span><span class="ansi-blue-fg">(*args, **kwargs)</span>

<span class="ansi-green-fg">/mnt/data/daten/PostDoc2/home/anaconda3/envs/ciao-4.12/lib/python3.7/site-packages/numpy/core/fromnumeric.py</span> in <span class="ansi-cyan-fg">prod</span><span class="ansi-blue-fg">(a, axis, dtype, out, keepdims, initial, where)</span>
<span class="ansi-green-intense-fg ansi-bold">   2960</span>     &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">   2961</span>     return _wrapreduction(a, np.multiply, &#39;prod&#39;, axis, dtype, out,
<span class="ansi-green-fg">-&gt; 2962</span><span class="ansi-red-fg">                           keepdims=keepdims, initial=initial, where=where)
</span><span class="ansi-green-intense-fg ansi-bold">   2963</span>
<span class="ansi-green-intense-fg ansi-bold">   2964</span>

<span class="ansi-green-fg">/mnt/data/daten/PostDoc2/home/anaconda3/envs/ciao-4.12/lib/python3.7/site-packages/numpy/core/fromnumeric.py</span> in <span class="ansi-cyan-fg">_wrapreduction</span><span class="ansi-blue-fg">(obj, ufunc, method, axis, dtype, out, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     88</span>                 <span class="ansi-green-fg">return</span> reduction<span class="ansi-blue-fg">(</span>axis<span class="ansi-blue-fg">=</span>axis<span class="ansi-blue-fg">,</span> out<span class="ansi-blue-fg">=</span>out<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>passkwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     89</span>
<span class="ansi-green-fg">---&gt; 90</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">return</span> ufunc<span class="ansi-blue-fg">.</span>reduce<span class="ansi-blue-fg">(</span>obj<span class="ansi-blue-fg">,</span> axis<span class="ansi-blue-fg">,</span> dtype<span class="ansi-blue-fg">,</span> out<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>passkwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     91</span>
<span class="ansi-green-intense-fg ansi-bold">     92</span>

<span class="ansi-red-fg">KeyboardInterrupt</span>:
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">K_simulated</span><span class="p">),</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;From simulated noise data&#39;</span><span class="p">)</span>
<span class="n">ylo</span><span class="p">,</span> <span class="n">yhi</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">ylo</span><span class="p">,</span> <span class="n">yhi</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;From our real data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Bayes factor&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>If we run this a bit longer, we will fill in the simulation histogram better. But already now we can see:</p>
<p>We are using simulations to measure how often, by chance, we would see a Bayes factor higher than the one we observe. By building up a histogram, we can get a p-value, telling us our false decision rate for any Bayes factor threshold. Thus, we are putting a frequentist property on our Bayesian inference-based decision.</p>
<p>So I would say: <strong>Pure noise does not produce as high a Bayes factor as we see it in the real data.</strong></p>
<p>Calibrating Bayes factor thresholds reduces the dependence on model priors and model parameter priors.</p>
<div class="section" id="Further-reading">
<h3>Further reading<a class="headerlink" href="#Further-reading" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Buchner+14 <a class="reference external" href="https://arxiv.org/abs/1402.0004">https://arxiv.org/abs/1402.0004</a> (§5.2, Appendix C for calibration)</p></li>
<li><p>Trotta+08 <a class="reference external" href="https://arxiv.org/abs/0803.4089">https://arxiv.org/abs/0803.4089</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Bayes_factor">https://en.wikipedia.org/wiki/Bayes_factor</a></p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="example-sine-highd.html" class="btn btn-neutral float-right" title="Higher-dimensional fitting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="example-sine-line.html" class="btn btn-neutral float-left" title="Time series fitting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014-2019, Johannes Buchner

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>